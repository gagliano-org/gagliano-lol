---
definisce:
  - "[[nostr/kind]]"
  - "[[tag]]"
kinds:
  - "[[30017]]"
  - "[[30018]]"
  - "[[30019]]"
_tags:
  - "[[t]]"
  - "[[d]]"
---
# NIP-15
## Nostr Marketplace (per mercati resilienti)
`bozza` `opzionale` `autore:fiatjaf` `autore:benarc` `autore:motorina0` `autore:talvasconcelos`

>Basato su https://github.com/lnbits/Diagon-Alley

>Implementato in [NostrMarket](https://github.com/lnbits/nostrmarket|) e [Plebeian Market](https://github.com/PlebeianTech/plebeian-market)

## Termini
- `merchant`: venditore di prodotti con coppia di chiavi NOSTR
- `customer`: acquirente di prodotti con coppia di chiavi NOSTR
- `product`: articolo in vendita dal commerciante
- `stall` (bancarella): elenco di prodotti controllati dal commerciante (un commerciante può avere più bancarelle)
- `marketplace` software lato client per cercare `stalls` e acquistare `products`
## Client di Nostr Marketplace
### Dashboard del commerciante
Dove il `merchant` crea, aggiorna e cancella `stall` e `products`, oltre a gestire vendite, pagamenti e comunicazioni con i clienti.

Il software di amministrazione del commerciante può essere puramente lato client, ma per comodità e tempo di attività, le implementazioni avranno probabilmente un client server in ascolto per gli eventi NOSTR.

### Marketplace
Il software del `marketplace` dovrebbe essere interamente lato client, sia come app stand-alone, sia come pagina web puramente front-end. Un cliente si iscrive a diverse chiavi pubbliche NOSTR dei `merchants`, e le `stall` e i `prodotti` di quei commercianti diventano elencati e ricercabili. Il client del `marketplace` è come qualsiasi altro sito di `ecommerce`, con carrello e checkout. I mercati potrebbero anche voler includere un’area di supporto al cliente per la comunicazione diretta con i commercianti.

## Pubblicazione/aggiornamento dei prodotti da parte del commerciante (evento)
Un commerciante può pubblicare questi eventi:

| Kind    |                  | Descrizione                                                                  |
| ------- | ---------------- | ---------------------------------------------------------------------------- |
| `0`     | `set_meta`       | La descrizione del commerciante (simile a qualsiasi chiave pubblica nostr)   |
| `30017` | `set_stall`      | Crea o aggiorna una bancarella.                                              |
| `4`     | `direct_message` | Comunica con il cliente. I messaggi possono essere in testo semplice o JSON. |
| `5`     | `delete`         | Cancella un prodotto o una bancarella.                                       |
### Evento 30017: Crea o aggiorna una bancarella.
#### Contenuto dell’evento:
```json
{
    "id": <String, UUID generated by the merchant. Sequential IDs (`0`, `1`, `2`...) are discouraged>,
    "name": <String, stall name>,
    "description": <String (optional), stall description>,
    "currency": <String, currency used>,
    "shipping": [
        {
            "id": <String, UUID of the shipping zone, generated by the merchant>,
            "name": <String (optional), zone name>,
            "cost": <float, base cost for shipping. The currency is defined at the stall level>,
            "regions": [<String, regions included in this zone>],
        }
    ]
}
```
Campi che non sono autoesplicativi:
- `spedizione`:
	- un array con possibili zone di spedizione per questa bancarella.
	- il cliente DEVE scegliere esattamente una di queste zone di spedizione.
	- la spedizione a zone diverse può avere costi diversi. Per alcuni beni (digitali ad esempio) il costo può essere zero.
	- l’`id` è un valore interno utilizzato dal commerciante. Questo valore deve essere rispedito come selezione del cliente.
	- ogni zona di spedizione contiene il costo base per gli ordini effettuati in quella zona di spedizione, ma un costo specifico di spedizione per prodotto può anche essere specificato se il costo di spedizione per quel prodotto è superiore a quello specificato dal costo base.
#### Tag dell’evento:

`“tags”: [[“d”, <Stringa, id della stall]]`
- il tag `d` è obbligatorio, il suo valore DEVE essere lo stesso dell’id della bancarella.
### Evento 30018: Crea o aggiorna un prodotto
#### Contenuto dell’evento:
```json
{
    "id": <String, UUID generated by the merchant.Sequential IDs (`0`, `1`, `2`...) are discouraged>,
    "stall_id": <String, UUID of the stall to which this product belong to>,
    "name": <String, product name>,
    "description": <String (optional), product description>,
    "images": <[String], array of image URLs, optional>,
    "currency": <String, currency used>,
    "price": <float, cost of product>,
    "quantity": <int, available items>,
    "specs": [
        [<String, spec key>, <String, spec value>]
    ],
    "shipping": [
        {
            "id": <String, UUID of the shipping zone. Must match one of the zones defined for the stall>,
            "cost": <float, extra cost for shipping. The currency is defined at the stall level>,
        }
    ]
}
```

^c5b663

Campi che non sono autoesplicativi:

- `specs`:
	- un array opzionale di valori chiave. Permette all’interfaccia utente del Cliente di presentare le specifiche del prodotto in modo strutturato. Permette anche il confronto tra i prodotti
	- es: `[[“sistema_operativo”, “Android 12.0”], [“dimensione_schermo”, “6,4 pollici”], [“tipo_connettore”, “USB Type C”]]`
	*Aperto*: sarebbe meglio spostare le `spec` nella sezione `tags` dell’evento?

- `shipping`:
	- un array opzionale di costi extra da utilizzare per zona di spedizione, solo per i prodotti che richiedono costi di spedizione speciali da aggiungere al costo base di spedizione definito nello stand
	- l’id dovrebbe corrispondere all’id della zona di spedizione, come definito nel campo spedizione dello stand
	- per calcolare il costo totale della spedizione per un ordine, l’utente sceglierà un’opzione di spedizione durante il checkout, e poi il cliente deve considerare questi costi:
		- il costo base dello stand per l’opzione di spedizione scelta
		- il risultato della moltiplicazione delle unità del prodotto per i costi di spedizione specificati nel prodotto, se presenti.
#### Tags dell'evento:
```json
 "tags": [
       ["d", <String, id of product],
       ["t", <String (optional), product category],
       ["t", <String (optional), product category],
       ...
    ]
```

^8c437b

- il tag `d` è obbligatorio, il suo valore DEVE essere lo stesso dell’`id` del prodotto.
- il tag `t` è un tag ricercabile, rappresenta diverse categorie di cui il prodotto può far parte (cibo, frutta). Possono essere presenti più tag `t`.
### Eventi di checkout
Tutti gli eventi di checkout vengono inviati come stringhe JSON utilizzando (`NIP04`).

Il `merchant` e il `customer` possono scambiarsi messaggi JSON che rappresentano diverse azioni. Ogni messaggio `JSON` DEVE avere un campo tipo che indica cosa rappresenta il JSON. Tipi possibili:

| Tipo di messaggio | Inviato da   | Descrizione                           |
| ----------------- | ------------ | ------------------------------------- |
| 0                 | Cliente      | Nuovo ordine                          |
| 1                 | Commerciante | Richiesta di pagamento                |
| 2                 | Commerciante | Aggiornamento dello stato dell’ordine |

#### Passaggio 1: ordine del cliente (evento)
Il json sottostante va nel contenuto del `NIP04`.
```json
{
    "id": <String, UUID generated by the customer>,
    "type": 0,
    "name": <String (optional), ???>,
    "address": <String (optional), for physical goods an address should be provided>
    "message": "<String (optional), message for merchant>,
    "contact": {
        "nostr": <32-bytes hex of a pubkey>,
        "phone": <String (optional), if the customer wants to be contacted by phone>,
        "email": <String (optional), if the customer wants to be contacted by email>,
    },
    "items": [
        {
            "product_id": <String, UUID of the product>,
            "quantity": <int, how many products the customer is ordering>
        }
    ],
    "shipping_id": <String, UUID of the shipping zone>
}
```

^c4113a

*Aperto*: `contact.nostr` è richiesto?

#### Passaggio 2: richiesta di pagamento del commerciante (evento)
Inviato dal commerciante per il pagamento. È valido qualsiasi metodo di pagamento accettato dal `merchant`.
Il json sottostante va nel contenuto del NIP04.

le `opzioni di pagamento`/`type` includono:

- url URL a una pagina di pagamento, stripe, paypal, btcpayserver, etc
- btc indirizzo bitcoin on-chain
- ln fattura lightning bitcoin
- lnurl bitcoin lnurl-pay
```json
{
    "id": <String, UUID of the order>,
    "type": 1,
    "message": <String, message to customer, optional>,
    "payment_options": [
        {
            "type": <String, option type>,
            "link": <String, url, btc address, ln invoice, etc>
        },
        {
            "type": <String, option type>,
            "link": <String, url, btc address, ln invoice, etc>
        },
                {
            "type": <String, option type>,
            "link": <String, url, btc address, ln invoice, etc>
        }
    ]
}
```

^30e2ef

#### Passaggio 3: il commerciante verifica il pagamento/spedito (evento)
Una volta ricevuto e processato il pagamento.

Il json sottostante va nel contenuto del `NIP04`.
```json
{
    "id": <String, UUID of the order>,
    "type": 2,
    "message": <String, message to customer>,
    "paid": <Bool, true/false has received payment>,
    "shipped": <Bool, true/false has been shipped>,
}
```

^faf489

### Personalizza il Marketplace
Crea un'esperienza utente personalizzata utilizzando l'indirizzo `naddr` da `NIP-19`. L'uso di `naddr` consente una facile condivisione degli eventi del marketplace incorporando una ricca serie di metadati. Questi metadati possono includere collegamenti, profili dei commercianti e altro ancora. Di conseguenza, consente ai commercianti di essere raggruppati in un mercato, permettendo al creatore del mercato di configurare l'interfaccia utente e l'esperienza utente del marketplace e di condividere quel marketplace. Questa personalizzazione può comprendere elementi come il nome del mercato, la descrizione, il logo, il banner, i temi e persino gli schemi di colore, offrendo un'esperienza di marketplace su misura e unica.

### Evento 30019: Crea o aggiorna l'UI/UX del marketplace
#### Contenuto dell'evento:
```json
{
    "name": <String (optional), market name>,
    "about": <String (optional), market description>,
    "ui": {
      "picture": <String (optional), market logo image URL>,
      "banner": <String (optional), market logo banner URL>,
      "theme": <String (optional), market theme>,
      "darkMode": <Bool, true/false>
    },
    "merchants": <[String] (optional), array of pubkeys>,
    ...
}
```
Questo evento sfrutta `naddr` per abilitare una personalizzazione completa e la condivisione delle configurazioni del marketplace, promuovendo un ambiente di marketplace unico e coinvolgente.

### Eventi di supporto clienti
Il supporto clienti viene gestito tramite il metodo di comunicazione specificato. Se si comunica tramite "nostr", viene utilizzato `NIP-04`: [https://github.com/nostr-protocol/nips/blob/master/04.md](https://github.com/nostr-protocol/nips/blob/master/04.md).

Aggiuntivo I modelli di dati standard possono essere trovati [qui](https://raw.githubusercontent.com/lnbits/nostrmarket/main/models.py).